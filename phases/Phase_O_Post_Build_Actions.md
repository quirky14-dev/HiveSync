# Phase O â€“ Post-Build Actions, Validation, Verification & Hardening

> **Purpose of Phase O:**
>
> * Perform **verification and hardening only** after Phase N has fully completed.
> * Validate that all generated code complies with every requirement from Phases Aâ€“N.
> * Enforce system-wide invariants related to safety, trust, billing, data protection, and reliability.
> * Perform sanity checks, smoke checks, and readiness confirmation.
> * Prepare the project for initial deployment and controlled go-live.
> * **NO new product features or architectural redesigns occur in this phase.**

---

## ðŸ”’ Phase O Execution Rules (Authoritative)

* Phase O MUST NOT begin unless the user explicitly says:
  **"BEGIN PHASE O"**
* Phase O MUST NOT redesign architecture or introduce new features.
* Phase O MUST NOT add new vendors or external dependencies.
* Phase O MUST NOT refactor code except where required for correctness, safety, or invariant enforcement.
* Phase O MAY generate reports, checklists, validation summaries, and **targeted corrective patches** required to satisfy the invariants below.

---

## O.1 Build Completion Verification

Confirm that Phase N produced the following:

### Core Systems

* Backend (FastAPI) fully implemented
* Database models and Alembic migrations present
* Python job worker system implemented
* Cloudflare Workers:

  * `worker_callback_relayer`
  * `healthcheck_worker`

### Clients

* Admin Web Dashboard
* Desktop client (Electron)
* Mobile / iPad client (React Native)
* HiveSync CLI
* IDE Plugins

### Deployment Artifacts

* Dockerfile
* docker-compose.yml
* wrangler.toml
* `.env.example`
* Alembic migration folder

If **ANY** item is missing, Phase O MUST halt and report the deficiency.

---

## O.2 Static Validation Checks

Replit MUST verify:

* No TODOs, placeholders, or stub implementations remain
* No hardcoded secrets exist
* All referenced environment variables are documented
* All APIs specified in Phase D exist and compile
* Database schema matches Phase C exactly
* Tier enforcement logic is present everywhere required

---

## O.3 Security & Compliance Review

Validate enforcement of Phase K rules:

* JWT validation on all protected endpoints
* HMAC verification for worker callbacks
* Rate limiting on authentication, billing, and heavy endpoints
* RBAC enforcement
* No secret leakage to clients
* Secure R2 access patterns
* Least-privilege secrets for workers and services

---

## O.4 Logging & Observability Review

Confirm Phase M compliance:

* Structured JSON logs only
* No PII in logs
* Correct log levels
* Worker, backend, and admin logs present
* Correlation / request IDs propagated across:

  * API requests
  * workers
  * webhook handlers

---

## O.5 Deployment Readiness Checklist

Confirm readiness for:

### Local

* `docker compose up` succeeds

### Linode

* SSL termination ready
* Firewall rules correct
* Backend reachable

### Cloudflare

* Workers deployable
* R2 lifecycle rules configured

---

## O.6 Smoke Test Scenarios (Manual)

Document expected behavior for:

* User signup & login
* Project creation
* Preview generation
* Multi-device preview
* Tier upgrade, downgrade, and cancellation
* Admin visibility and overrides

(No automated execution required here.)

---

## O.7 System Invariants & Hardening (Post-Build Enforcement)

### O.7.1 No Silent Failures

* Any user-facing failure MUST return a clear error message with a next step.
* UI MUST NOT fail silently (no dead buttons, infinite spinners, or empty screens without explanation).

### O.7.2 Safe Defaults

* On entitlement or tier ambiguity, default to the **lower entitlement** without data loss.
* System must remain usable in reduced functionality mode.

### O.7.3 Idempotency (Critical)

* All webhook handlers MUST be idempotent.
* All create / generate / checkout-style endpoints MUST be safe against retries and duplicate submissions.

---

## O.8 Billing & Subscription Safety (LemonSqueezy)

* Frontends MUST NEVER communicate directly with LemonSqueezy.
* All billing URLs MUST be generated by the backend after authentication.
* Webhooks MUST be verified and replay-safe.
* Subscription state MUST be derived from webhook-confirmed backend records.

### Cancellation & Downgrade Guarantees

* Cancellation MUST require explicit user confirmation in the Web Account Portal.
* Cancellation MUST NOT delete user data.
* Access MUST persist until the end of the paid period unless revoked for policy violations.
* Downgrades apply at next renewal unless explicitly configured otherwise.
* Founder or discounted pricing forfeiture on cancellation MUST be enforced server-side.

---

## O.9 Entitlements, Limits & Trust UX

* All limits MUST be enforced server-side.
* When limits block an action, backend MUST return:

  * stable error code
  * user-facing explanation
  * clear next action (upgrade, wait, retry)
* No surprise paywalls or silent limit failures are permitted.

---

## O.10 Data Safety & Integrity

* No user-generated data may be auto-deleted due to billing changes.
* All destructive actions require explicit user confirmation.
* Backups MUST exist for databases and object storage.
* Multi-step writes must be transactional or compensating.
* Audit fields (`created_at`, `updated_at`, etc.) must exist for key entities.

---

## O.11 Workers, Queues & Reliability

* Worker jobs MUST have bounded retries with exponential backoff.
* Permanent failures MUST be observable (failed-job or dead-letter visibility).
* Jobs MUST be idempotent.
* Concurrency, timeout, and circuit-breaker limits must exist.

---

## O.12 Rate Limiting, Abuse & Cost Controls

* Rate limits MUST exist for auth, billing session creation, AI-heavy endpoints, and preview rendering.
* Hard caps on AI usage MUST be enforced server-side.
* Admin emergency kill-switches must exist for high-cost features.

---

## O.13 UI & Client Hardening

* All clients MUST comply with `docs/asset_contract.md`.
* Missing assets MUST degrade gracefully with placeholders.
* Offline or degraded backend states MUST surface clear messaging.
* Pricing, limits, and copy must be backend-driven to avoid client redeploys.

---

## O.14 Release, Rollback & Emergency Readiness

* Feature flags must be server-controlled and reversible.
* Database migrations must have rollback or forward-only recovery plans.
* A minimal emergency playbook must exist covering:

  * disabling expensive features
  * pausing new signups
  * restoring from backups
  * safely reprocessing failed webhooks

---

## O.15 Go-Live Authorization

Phase O completes ONLY when:

* All checks above pass
* All invariants are satisfied
* User explicitly approves deployment

At completion:

* STOP
* Do NOT proceed further unless instructed

---

## End of Phase O

Phase O is complete when the system is verified, hardened, and ready for controlled launch.
